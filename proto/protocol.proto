edition = "2023";

message Triple {
  string subject = 1;
  string predicate = 2;
  oneof object {
    string s = 3;
    double n = 4;
    bool b = 5;
  }
}

message TripleUpdate {
  Triple triple = 1;
  string hlc = 2; // Hybrid Logical Clock timestamp
}

message ClientMessage {
  uint32 request_id = 1;
  oneof payload {
    QueryRequest query = 2; // One-time query
    SubscribeRequest subscribe = 3; // Reactive subscription
    uint32 unsubscribe_id = 4; // subscription_id to stop
    TransactRequest transact = 5; // Client-side updates
  }
}

message QueryRequest {
  // repeated Pattern patterns = 1; // e.g., ["id-123", "user/*", ?]
  // repeated Filter filters = 2; // e.g., "age > 30"
}

message SubscribeRequest {
  uint32 subscription_id = 1;
  // repeated Pattern patterns = 2;
  string since_hlc = 3; // Optional: Resume from this point
}

message TransactRequest {
  repeated TripleUpdate updates = 1;
}

message ServerMessage {
  uint32 request_id = 1;
  oneof payload {
    // QueryResult result = 2; // Response to QueryRequest
    TripleUpdate update = 3; // Streamed update from subscription
    Ack ack = 4; // Response to TransactRequest
  }
}

message Ack {
  bool success = 1;
  string error = 2;
}
